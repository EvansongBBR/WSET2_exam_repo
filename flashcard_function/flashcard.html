<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSET2 è‘¡è„é…’å­¦ä¹ åŠ©æ‰‹</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Firebase CDNs (type="module" scripts are deferred by default) -->
    <script type="module">
        // ä»Firebase CDNå¯¼å…¥æ¨¡å—
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // å°†Canvasç¯å¢ƒä¸­å¯èƒ½æä¾›çš„å…¨å±€å˜é‡æ³¨å…¥åˆ°windowå¯¹è±¡ï¼Œä»¥ä¾¿åœ¨è„šæœ¬ä¸­è®¿é—®
        // è¿™äº›å˜é‡é€šå¸¸ç”±Canvasç¯å¢ƒæä¾›ï¼Œç”¨äºåˆå§‹åŒ–Firebaseå’Œç”¨æˆ·è®¤è¯
        window.__app_id = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        window.__firebase_config = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        window.__initial_auth_token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // ç›´æ¥å°†Firebaseå‡½æ•°æš´éœ²åˆ°å…¨å±€windowå¯¹è±¡ï¼Œä¾›åç»­çš„Reactä»£ç ä½¿ç”¨
        window.initializeApp = initializeApp;
        window.getAuth = getAuth;
        window.signInAnonymously = signInAnonymously;
        window.signInWithCustomToken = signInWithCustomToken;
        window.onAuthStateChanged = onAuthStateChanged;
        window.getFirestore = getFirestore;
        window.doc = doc;
        window.setDoc = setDoc;
        window.onSnapshot = onSnapshot;
    </script>
    <style>
        /* å…¨å±€åŠ¨ç”»å®šä¹‰ */
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .animate-gradient-shift {
            background: linear-gradient(135deg, #fce4ec, #e0f2f7, #ffe0b2, #f3e5f5); /* æ›´äº®ã€æ›´å¤šå˜çš„æ¸å˜è‰² */
            background-size: 400% 400%;
            animation: gradient-shift 15s ease infinite;
        }
        @keyframes float-subtle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        .animate-float-subtle {
            animation: float-subtle 4s ease-in-out infinite;
        }
        @keyframes slide-in-bottom {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-in-bottom {
            animation: slide-in-bottom 0.6s ease-out forwards;
        }
        /* æŠ½è®¤å¡3Dç¿»è½¬æ•ˆæœæ ·å¼ */
        .flashcard-container {
            position: relative;
            transform-style: preserve-3d;
        }
        .flashcard-face, .flashcard-back {
            backface-visibility: hidden;
        }
        .rotate-y-180 {
            transform: rotateY(180deg);
        }
    </style>
</head>
<body class="font-inter antialiased">
    <div id="root"></div>

    <script type="text/javascript">
        // ç¡®ä¿åœ¨æ•´ä¸ªé¡µé¢åŠ è½½å®Œæˆåå†è¿è¡ŒReactåº”ç”¨
        window.onload = function() {
            // è·å–Reactçš„hookså’ŒFirebaseå¯¼å‡ºçš„å‡½æ•° (ç°åœ¨ç›´æ¥ä»windowè·å–)
            const { useState, useEffect, createContext, useContext } = React;
            const { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, getFirestore, doc, setDoc, onSnapshot } = window;

            // åˆ›å»ºFirebaseä¸Šä¸‹æ–‡
            const FirebaseContext = createContext(null);

            /**
             * Appç»„ä»¶æ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ ¹ç»„ä»¶ã€‚
             * å®ƒè´Ÿè´£Firebaseçš„åˆå§‹åŒ–ã€ç”¨æˆ·è®¤è¯ã€æ•°æ®è§£æä»¥åŠæ¨¡å¼åˆ‡æ¢ï¼ˆå­¦ä¹ æ¨¡å¼æˆ–æŠ½è®¤å¡æ¨¡å¼ï¼‰ã€‚
             */
            const App = () => {
                // å®šä¹‰å½“å‰åº”ç”¨ç¨‹åºçš„æ¨¡å¼ï¼š'home'ï¼ˆä¸»é¡µï¼‰, 'learn'ï¼ˆå­¦ä¹ ï¼‰, 'flashcard'ï¼ˆæŠ½è®¤å¡ï¼‰
                const [mode, setMode] = useState('home');
                // Firebaseç›¸å…³çš„çŠ¶æ€
                const [app, setApp] = useState(null);
                const [db, setDb] = useState(null);
                const [auth, setAuth] = useState(null);
                const [userId, setUserId] = useState(null); // å½“å‰ç”¨æˆ·çš„ID
                const [isAuthReady, setIsAuthReady] = useState(false); // è®¤è¯æ˜¯å¦å®Œæˆ
                // å­¦ä¹ è¿›åº¦çŠ¶æ€ï¼ŒåŒ…æ‹¬ä¸Šæ¬¡å­¦ä¹ çš„ç´¢å¼•å’Œå·²æŒæ¡çš„æŠ½è®¤å¡
                const [learningProgress, setLearningProgress] = useState({ lastLearnedIndex: 0, learnedFlashcards: {} });
                // åŠ è½½çŠ¶æ€ï¼Œç”¨äºæ˜¾ç¤ºåŠ è½½æç¤º
                const [loadingFirebase, setLoadingFirebase] = useState(true);
                // æ–°å¢ï¼šåŠ è½½è¯æ±‡æ•°æ®çš„çŠ¶æ€
                const [loadingVocabulary, setLoadingVocabulary] = useState(true);
                // è¯æ±‡æ•°æ®çŠ¶æ€
                const [vocabulary, setVocabulary] = useState([]);

                /**
                 * è§£æCSVå­—ç¬¦ä¸²ä¸ºè¯æ±‡æ•°ç»„ã€‚
                 * @param {string} csv - å¾…è§£æçš„CSVå­—ç¬¦ä¸²ã€‚
                 * @returns {Array<Object>} - åŒ…å«ä¸­æ–‡ã€è‹±æ–‡å’Œè¯´æ˜çš„è¯æ±‡å¯¹è±¡æ•°ç»„ã€‚
                 */
                const parseCSV = (csv) => {
                    // æŒ‰è¡Œåˆ†å‰²ï¼Œå¹¶è¿‡æ»¤æ‰ç©ºè¡Œ
                    const lines = csv.split('\n').filter(line => line.trim() !== '');
                    if (lines.length === 0) return [];

                    // è·³è¿‡æ ‡é¢˜è¡Œï¼Œç›´æ¥å¤„ç†æ•°æ®
                    const data = [];
                    for (let i = 1; i < lines.length; i++) {
                        const currentLine = lines[i].split(',');
                        // ç¡®ä¿è¡Œæœ‰è¶³å¤Ÿçš„åˆ—
                        if (currentLine.length < 2) continue;

                        const item = {};
                        item.chinese = currentLine[0] ? currentLine[0].trim() : '';
                        item.english = currentLine[1] ? currentLine[1].trim() : '';
                        // å°†å‰©ä½™éƒ¨åˆ†åˆå¹¶ä¸ºè¯´æ˜ï¼Œä»¥é˜²è¯´æ˜ä¸­åŒ…å«é€—å·
                        item.explanation = currentLine.slice(2).join(',').trim();
                        data.push(item);
                    }
                    return data;
                };

                // Firebaseåˆå§‹åŒ–å’Œè®¤è¯çš„useEffect
                useEffect(() => {
                    const initializeFirebase = async () => {
                        try {
                            // ä»windowå¯¹è±¡è·å–Firebaseé…ç½®
                            const firebaseConfig = window.__firebase_config;
                            const initializedApp = initializeApp(firebaseConfig);
                            const firestoreDb = getFirestore(initializedApp);
                            const firebaseAuth = getAuth(initializedApp);

                            setApp(initializedApp);
                            setDb(firestoreDb);
                            setAuth(firebaseAuth);

                            // ä»windowå¯¹è±¡è·å–åˆå§‹è®¤è¯ä»¤ç‰Œ
                            const initialAuthToken = window.__initial_auth_token;

                            // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
                            onAuthStateChanged(firebaseAuth, async (user) => {
                                if (user) {
                                    // å¦‚æœç”¨æˆ·å·²è®¤è¯ï¼Œè®¾ç½®ç”¨æˆ·ID
                                    setUserId(user.uid);
                                    setIsAuthReady(true);
                                } else {
                                    // å¦‚æœç”¨æˆ·æœªè®¤è¯ï¼Œå°è¯•ä½¿ç”¨è‡ªå®šä¹‰ä»¤ç‰Œæˆ–åŒ¿åç™»å½•
                                    try {
                                        if (initialAuthToken) {
                                            await signInWithCustomToken(firebaseAuth, initialAuthToken);
                                        } else {
                                            await signInAnonymously(firebaseAuth);
                                        }
                                    } catch (error) {
                                        console.error("Firebaseè®¤è¯é”™è¯¯:", error);
                                        // å¦‚æœåŒ¿åç™»å½•å¤±è´¥ï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªéšæœºIDä½œä¸ºç”¨æˆ·ID
                                        setUserId(crypto.randomUUID());
                                        setIsAuthReady(true);
                                    }
                                }
                                setLoadingFirebase(false); // è®¤è¯å®Œæˆåï¼Œè®¾ç½®åŠ è½½çŠ¶æ€ä¸ºfalse
                            });
                        } catch (error) {
                            console.error("åˆå§‹åŒ–Firebaseå¤±è´¥:", error);
                            setLoadingFirebase(false);
                        }
                    };

                    initializeFirebase();
                }, []); // ç©ºä¾èµ–æ•°ç»„ç¡®ä¿åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶è¿è¡Œä¸€æ¬¡

                // ç›‘å¬å­¦ä¹ è¿›åº¦æ›´æ–°çš„useEffect
                useEffect(() => {
                    // åªæœ‰å½“Firestoreã€ç”¨æˆ·IDå’Œè®¤è¯å‡†å¤‡å°±ç»ªåæ‰ç›‘å¬
                    if (!db || !userId || !isAuthReady) return;

                    // è·å–åº”ç”¨ç¨‹åºIDï¼Œå¦‚æœæœªå®šä¹‰åˆ™ä½¿ç”¨é»˜è®¤å€¼
                    const appId = window.__app_id;
                    // æ„å»ºFirestoreæ–‡æ¡£å¼•ç”¨è·¯å¾„ï¼Œå­˜å‚¨åœ¨ç”¨æˆ·ç§æœ‰æ•°æ®ä¸­
                    const progressDocRef = doc(db, `artifacts/${appId}/users/${userId}/wine_learning_progress`, 'progress');

                    // å®æ—¶ç›‘å¬æ–‡æ¡£å¿«ç…§
                    const unsubscribe = onSnapshot(progressDocRef, (docSnap) => {
                        if (docSnap.exists()) {
                            // å¦‚æœæ–‡æ¡£å­˜åœ¨ï¼Œæ›´æ–°å­¦ä¹ è¿›åº¦çŠ¶æ€
                            const data = docSnap.data();
                            setLearningProgress({
                                lastLearnedIndex: data.lastLearnedIndex || 0,
                                learnedFlashcards: data.learnedFlashcards || {},
                            });
                        } else {
                            // å¦‚æœæ–‡æ¡£ä¸å­˜åœ¨ï¼Œåˆ›å»ºåˆå§‹è¿›åº¦æ–‡æ¡£
                            setDoc(progressDocRef, { lastLearnedIndex: 0, learnedFlashcards: {} })
                                .catch(error => console.error("åˆ›å»ºåˆå§‹è¿›åº¦æ–‡æ¡£é”™è¯¯:", error));
                        }
                    }, (error) => {
                        console.error("ç›‘å¬è¿›åº¦é”™è¯¯:", error);
                    });

                    return () => unsubscribe(); // ç»„ä»¶å¸è½½æ—¶å–æ¶ˆç›‘å¬
                }, [db, userId, isAuthReady]); // ä¾èµ–é¡¹ï¼šdb, userId, isAuthReady

                // åŠ è½½CSVæ–‡ä»¶çš„useEffect
                useEffect(() => {
                    const loadVocabulary = async () => {
                        try {
                            // TODO: è¯·å°† 'è‘¡è„é…’å¤ä¹ çŸ¥è¯†è‹¦_ä¸­è‹±æ–‡å¯¹ç…§è¡¨.xlsx - ä¸­è‹±æ–‡å¯¹ç…§è¡¨.csv' æ›¿æ¢ä¸ºæ‚¨å®é™…çš„CSVæ–‡ä»¶å
                            // æ³¨æ„ï¼šç°åœ¨CSVæ–‡ä»¶å‡è®¾ä½äº 'data/' æ–‡ä»¶å¤¹ä¸­ï¼Œä¸” 'flashcard.html' ä½äº 'flashcard_function/'
                            // å› æ­¤ç›¸å¯¹è·¯å¾„ä¸º '../data/æ‚¨çš„å®é™…æ–‡ä»¶å.csv'
                            const filename = 'origin_table_ch_en.csv'; // è¿™é‡Œä½¿ç”¨æ‚¨çš„å®é™…æ–‡ä»¶å
                            const encodedFilename = encodeURIComponent(filename);
                            // å‡è®¾CSVæ–‡ä»¶ä½äº data/ ç›®å½•ä¸‹ï¼Œä¸”å½“å‰HTMLæ–‡ä»¶åœ¨ flashcard_function/ ç›®å½•ä¸‹
                            // æ‰€ä»¥è·¯å¾„æ˜¯ '../data/encodedFilename'
                            const response = await fetch(`../data/${encodedFilename}`); // ä¿®æ”¹ç‚¹ï¼šè·¯å¾„è°ƒæ•´ä¸ºæŒ‡å‘ data æ–‡ä»¶å¤¹
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            const text = await response.text();
                            const parsedData = parseCSV(text);
                            setVocabulary(parsedData);
                        } catch (error) {
                            console.error("åŠ è½½è¯æ±‡æ•°æ®å¤±è´¥:", error);
                            // å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸ªé”™è¯¯çŠ¶æ€æˆ–æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„æ¶ˆæ¯
                        } finally {
                            setLoadingVocabulary(false);
                        }
                    };

                    loadVocabulary();
                }, []); // ç©ºä¾èµ–æ•°ç»„ç¡®ä¿åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½ä¸€æ¬¡

                /**
                 * æ›´æ–°Firestoreä¸­çš„å­¦ä¹ è¿›åº¦ã€‚
                 * @param {Object} newProgress - åŒ…å«è¦æ›´æ–°çš„è¿›åº¦çš„å¯¹è±¡ã€‚
                 */
                const updateLearningProgress = async (newProgress) => {
                    if (!db || !userId) {
                        console.error("Firestoreæœªåˆå§‹åŒ–æˆ–ç”¨æˆ·æœªè®¤è¯ã€‚");
                        return;
                    }
                    const appId = window.__app_id;
                    const progressDocRef = doc(db, `artifacts/${appId}/users/${userId}/wine_learning_progress`, 'progress');
                    try {
                        // ä½¿ç”¨merge: trueï¼Œä»¥ä¾¿åªæ›´æ–°æŒ‡å®šçš„å­—æ®µè€Œä¸è¦†ç›–æ•´ä¸ªæ–‡æ¡£
                        await setDoc(progressDocRef, newProgress, { merge: true });
                    } catch (error) {
                        console.error("æ›´æ–°å­¦ä¹ è¿›åº¦é”™è¯¯:", error);
                    }
                };

                /**
                 * å¤„ç†æ¨¡å¼åˆ‡æ¢ã€‚
                 * @param {string} newMode - æ–°çš„æ¨¡å¼ï¼ˆ'home', 'learn', 'flashcard'ï¼‰ã€‚
                 */
                const handleModeChange = (newMode) => {
                    setMode(newMode);
                };

                // å¦‚æœFirebaseæˆ–è¯æ±‡æ•°æ®æ­£åœ¨åŠ è½½ï¼Œæ˜¾ç¤ºåŠ è½½æç¤º
                if (loadingFirebase || loadingVocabulary) {
                    return React.createElement(
                        'div',
                        { className: 'flex items-center justify-center min-h-screen font-inter animate-gradient-shift' },
                        React.createElement('p', { className: 'text-xl text-gray-700' }, 'åŠ è½½ä¸­...')
                    );
                }

                return React.createElement(
                    FirebaseContext.Provider,
                    { value: { db, userId, learningProgress, updateLearningProgress, vocabulary } },
                    React.createElement(
                        'div',
                        { className: 'min-h-screen w-full flex flex-col items-center py-8 px-4 font-inter antialiased relative overflow-hidden animate-gradient-shift' },
                        React.createElement(
                            'h1',
                            { className: 'text-5xl sm:text-6xl font-extrabold text-gray-900 mb-8 rounded-xl p-3 bg-white bg-opacity-90 shadow-2xl text-center leading-tight tracking-tight transform hover:scale-105 transition-transform duration-300 ease-out animate-float-subtle' },
                            'WSET2 è‘¡è„é…’å­¦ä¹ åŠ©æ‰‹'
                        ),
                        // æ˜¾ç¤ºç”¨æˆ·IDï¼Œæ–¹ä¾¿å¤šç”¨æˆ·åä½œ
                        userId && React.createElement(
                            'div',
                            { className: 'bg-white p-2 rounded-md shadow-sm mb-4' },
                            React.createElement('p', { className: 'text-xs sm:text-sm text-gray-600' }, 'ç”¨æˆ·ID: ', React.createElement('span', { className: 'font-mono break-all' }, userId))
                        ),
                        // æ ¹æ®å½“å‰æ¨¡å¼æ¸²æŸ“ä¸åŒç»„ä»¶
                        mode === 'home' && React.createElement(HomePage, { onSelectMode: handleModeChange }),
                        mode === 'learn' && React.createElement(LearningMode, { onBack: () => setMode('home') }),
                        mode === 'flashcard' && React.createElement(FlashcardMode, { onBack: () => setMode('home') })
                    )
                );
            };

            /**
             * HomePageç»„ä»¶ï¼šæ˜¾ç¤ºä¸¤ç§å­¦ä¹ æ¨¡å¼çš„é€‰æ‹©æŒ‰é’®ã€‚
             * ç•Œé¢å°†æ›´åŠ æ´»æ³¼ï¼Œå¸¦æœ‰åŠ¨æ€æ•ˆæœã€‚
             * @param {Object} props - ç»„ä»¶å±æ€§ã€‚
             * @param {Function} props.onSelectMode - é€‰æ‹©æ¨¡å¼çš„å›è°ƒå‡½æ•°ã€‚
             */
            const HomePage = ({ onSelectMode }) => {
                return React.createElement(
                    'div',
                    { className: 'flex flex-col space-y-6 w-full max-w-sm sm:max-w-md p-6 bg-white bg-opacity-95 rounded-2xl shadow-3xl transform -translate-y-2 animate-slide-in-bottom border border-gray-100' },
                    React.createElement(
                        'button',
                        { className: 'bg-red-700 hover:bg-red-800 text-white font-bold py-5 px-8 rounded-full shadow-xl transition-all duration-300 ease-in-out transform hover:scale-110 hover:rotate-1 focus:outline-none focus:ring-6 focus:ring-red-300 active:bg-red-900 text-xl tracking-wider', onClick: () => onSelectMode('learn') },
                        'ğŸ· åºåˆ—å­¦ä¹ '
                    ),
                    React.createElement(
                        'button',
                        { className: 'bg-purple-700 hover:bg-purple-800 text-white font-bold py-5 px-8 rounded-full shadow-xl transition-all duration-300 ease-in-out transform hover:scale-110 hover:-rotate-1 focus:outline-none focus:ring-6 focus:ring-purple-300 active:bg-purple-900 text-xl tracking-wider', onClick: () => onSelectMode('flashcard') },
                        'âœ¨ æŠ½è®¤å¡å¤ä¹ '
                    )
                );
            };

            /**
             * LearningModeç»„ä»¶ï¼šæä¾›è¯æ±‡çš„é¡ºåºå­¦ä¹ åŠŸèƒ½ã€‚
             * @param {Object} props - ç»„ä»¶å±æ€§ã€‚
             * @param {Function} props.onBack - è¿”å›ä¸»é¡µçš„å›è°ƒå‡½æ•°ã€‚
             */
            const LearningMode = ({ onBack }) => {
                // ä»ä¸Šä¸‹æ–‡ä¸­è·å–å­¦ä¹ è¿›åº¦ã€æ›´æ–°å‡½æ•°å’Œè¯æ±‡æ•°æ®
                const { learningProgress, updateLearningProgress, vocabulary } = useContext(FirebaseContext);
                // å½“å‰æ˜¾ç¤ºçš„è¯æ±‡ç´¢å¼•
                const [currentIndex, setCurrentIndex] = useState(0);
                // æ§åˆ¶è¯´æ˜æ˜¯å¦æ˜¾ç¤º
                const [showExplanation, setShowExplanation] = useState(false);

                // ç»„ä»¶æŒ‚è½½æ—¶ï¼Œè®¾ç½®å½“å‰ç´¢å¼•ä¸ºä¸Šæ¬¡å­¦ä¹ çš„ç´¢å¼•
                useEffect(() => {
                    if (learningProgress) {
                        setCurrentIndex(learningProgress.lastLearnedIndex);
                    }
                }, [learningProgress]);

                /**
                 * å¤„ç†â€œä¸‹ä¸€é¡µâ€æŒ‰é’®ç‚¹å‡»äº‹ä»¶ã€‚
                 * æ›´æ–°ç´¢å¼•ï¼Œéšè—è¯´æ˜ï¼Œå¹¶æ›´æ–°Firestoreä¸­çš„å­¦ä¹ è¿›åº¦ã€‚
                 */
                const handleNext = () => {
                    const nextIndex = (currentIndex + 1) % vocabulary.length;
                    setCurrentIndex(nextIndex);
                    setShowExplanation(false);
                    updateLearningProgress({ lastLearnedIndex: nextIndex });
                };

                /**
                 * å¤„ç†â€œä¸Šä¸€é¡µâ€æŒ‰é’®ç‚¹å‡»äº‹ä»¶ã€‚
                 * æ›´æ–°ç´¢å¼•ï¼Œéšè—è¯´æ˜ã€‚ä¸æ›´æ–°Firestoreä¸­çš„lastLearnedIndexã€‚
                 */
                const handlePrevious = () => {
                    const prevIndex = (currentIndex - 1 + vocabulary.length) % vocabulary.length;
                    setCurrentIndex(prevIndex);
                    setShowExplanation(false);
                };

                /**
                 * å¤„ç†â€œæˆ‘å­¦ä¼šäº†â€æŒ‰é’®ç‚¹å‡»äº‹ä»¶ã€‚
                 * æœ¬è´¨ä¸Šå°±æ˜¯å‰è¿›åˆ°ä¸‹ä¸€é¡¹ã€‚
                 */
                const handleMarkLearned = () => {
                    handleNext();
                };

                // å¦‚æœè¯æ±‡æ•°æ®ä¸ºç©ºï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                if (vocabulary.length === 0) {
                    return React.createElement(
                        'div',
                        { className: 'text-center p-4 bg-white rounded-lg shadow-md max-w-md mx-auto' },
                        React.createElement('p', { className: 'text-lg text-gray-700 mb-4' }, 'æ²¡æœ‰å¯ç”¨çš„è¯æ±‡ã€‚è¯·æ£€æŸ¥æ•°æ®æºã€‚'),
                        React.createElement(
                            'button',
                            { className: 'bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105', onClick: onBack },
                            'è¿”å›ä¸»é¡µ'
                        )
                    );
                }

                // è·å–å½“å‰æ˜¾ç¤ºçš„è¯æ±‡é¡¹
                const currentItem = vocabulary[currentIndex];

                return React.createElement(
                    'div',
                    { className: 'flex flex-col items-center w-full max-w-xl sm:max-w-2xl bg-white p-6 rounded-lg shadow-xl border border-gray-200' },
                    React.createElement('h2', { className: 'text-2xl sm:text-3xl font-bold mb-6 text-gray-800' }, 'æŒ‰ç…§åºåˆ—å­¦ä¹ '),
                    React.createElement(
                        'div',
                        { className: 'w-full text-center mb-6 p-6 border-2 border-blue-300 rounded-xl bg-blue-50 transition-all duration-300 ease-in-out' },
                        React.createElement('p', { className: 'text-2xl sm:text-3xl font-semibold mb-2 text-blue-800' }, currentItem.chinese),
                        React.createElement('p', { className: 'text-xl sm:text-2xl text-blue-700 mb-4' }, currentItem.english),
                        showExplanation && React.createElement('p', { className: 'text-md sm:text-lg text-gray-600 mt-4 leading-relaxed' }, currentItem.explanation)
                    ),
                    React.createElement(
                        'button',
                        { className: 'bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-all duration-300 ease-in-out transform hover:scale-105 mb-6 focus:outline-none focus:ring-4 focus:ring-purple-300', onClick: () => setShowExplanation(!showExplanation) },
                        showExplanation ? 'éšè—è¯´æ˜' : 'æ˜¾ç¤ºè¯´æ˜'
                    ),
                    React.createElement(
                        'div',
                        { className: 'flex justify-between w-full max-w-xs sm:max-w-sm mb-6' },
                        React.createElement(
                            'button',
                            { className: 'bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-300', onClick: handlePrevious },
                            'ä¸Šä¸€é¡µ'
                        ),
                        React.createElement(
                            'button',
                            { className: 'bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300', onClick: handleNext },
                            `ä¸‹ä¸€é¡µ (${currentIndex + 1}/${vocabulary.length})`
                        )
                    ),
                    React.createElement(
                        'button',
                        { className: 'bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-xl shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105 hover:shadow-2xl focus:outline-none focus:ring-4 focus:ring-green-300', onClick: handleMarkLearned },
                        'æˆ‘å­¦ä¼šäº† (å‰å¾€ä¸‹ä¸€é¡¹)'
                    ),
                    React.createElement(
                        'button',
                        { className: 'mt-8 bg-gray-400 hover:bg-gray-500 text-white font-bold py-2.5 px-5 rounded-lg shadow-md transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-200', onClick: onBack },
                        'è¿”å›ä¸»é¡µ'
                    )
                );
            };

            /**
             * FlashcardModeç»„ä»¶ï¼šæä¾›æŠ½è®¤å¡å¤ä¹ åŠŸèƒ½ã€‚
             * @param {Object} props - ç»„ä»¶å±æ€§ã€‚
             * @param {Function} props.onBack - è¿”å›ä¸»é¡µçš„å›è°ƒå‡½æ•°ã€‚
             */
            const FlashcardMode = ({ onBack }) => {
                // ä»ä¸Šä¸‹æ–‡ä¸­è·å–å­¦ä¹ è¿›åº¦ã€æ›´æ–°å‡½æ•°å’Œè¯æ±‡æ•°æ®
                const { learningProgress, updateLearningProgress, vocabulary } = useContext(FirebaseContext);
                // ä¹±åºåçš„è¯æ±‡æ•°ç»„
                const [shuffledVocabulary, setShuffledVocabulary] = useState([]);
                // å½“å‰æŠ½è®¤å¡çš„ç´¢å¼•
                const [currentFlashcardIndex, setCurrentFlashcardIndex] = useState(0);
                // æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºæŠ½è®¤å¡èƒŒé¢ï¼ˆå³è‹±æ–‡å’Œè¯´æ˜ï¼‰
                const [showBack, setShowBack] = useState(false);

                // ç»„ä»¶æŒ‚è½½æ—¶æˆ–è¯æ±‡æ•°æ®å˜åŒ–æ—¶ï¼Œæ´—ç‰Œè¯æ±‡å¹¶é‡ç½®ç´¢å¼•
                useEffect(() => {
                    handleShuffle();
                }, [vocabulary]); // ä¾èµ–é¡¹ï¼švocabulary

                /**
                 * å¤„ç†æŠ½è®¤å¡ç¿»è½¬ã€‚
                 */
                const handleFlip = () => {
                    setShowBack(!showBack);
                };

                /**
                 * å¤„ç†â€œä¸‹ä¸€å¼ â€æŠ½è®¤å¡ç‚¹å‡»äº‹ä»¶ã€‚
                 * æ›´æ–°ç´¢å¼•ï¼Œéšè—èƒŒé¢ã€‚
                 */
                const handleNextFlashcard = () => {
                    const nextIndex = (currentFlashcardIndex + 1) % shuffledVocabulary.length;
                    setCurrentFlashcardIndex(nextIndex);
                    setShowBack(false); // ç¿»åˆ°ä¸‹ä¸€å¼ æ—¶ï¼Œé»˜è®¤æ˜¾ç¤ºæ­£é¢
                };

                /**
                 * å¤„ç†â€œæˆ‘æŒæ¡äº†è¿™å¼ å¡ç‰‡â€æŒ‰é’®ç‚¹å‡»äº‹ä»¶ã€‚
                 * å°†å½“å‰å¡ç‰‡æ ‡è®°ä¸ºå·²æŒæ¡ï¼Œå¹¶æ›´æ–°Firestoreï¼Œç„¶åå‰è¿›åˆ°ä¸‹ä¸€å¼ ã€‚
                 */
                const handleMarkLearned = () => {
                    if (!shuffledVocabulary[currentFlashcardIndex]) return;

                    const term = shuffledVocabulary[currentFlashcardIndex].chinese;
                    // ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ¥å­˜å‚¨å·²æŒæ¡çš„å¡ç‰‡ï¼Œé”®æ˜¯ä¸­æ–‡è¯æ±‡ï¼Œå€¼ä¸ºtrue
                    const newLearnedFlashcards = { ...learningProgress.learnedFlashcards, [term]: true };
                    updateLearningProgress({ ...learningProgress, learnedFlashcards: newLearnedFlashcards });
                    handleNextFlashcard();
                };

                /**
                 * å¤„ç†â€œæ´—ç‰Œâ€æŒ‰é’®ç‚¹å‡»äº‹ä»¶ã€‚
                 * é‡æ–°æ‰“ä¹±è¯æ±‡é¡ºåºï¼Œå¹¶é‡ç½®åˆ°ç¬¬ä¸€å¼ å¡ç‰‡ã€‚
                 */
                const handleShuffle = () => {
                    setShuffledVocabulary([...vocabulary].sort(() => Math.random() - 0.5));
                    setCurrentFlashcardIndex(0);
                    setShowBack(false);
                };

                // å¦‚æœè¯æ±‡æ•°æ®ä¸ºç©ºï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                if (vocabulary.length === 0) {
                    return React.createElement(
                        'div',
                        { className: 'text-center p-4 bg-white rounded-lg shadow-md max-w-md mx-auto' },
                        React.createElement('p', { className: 'text-lg text-gray-700 mb-4' }, 'æ²¡æœ‰å¯ç”¨çš„è¯æ±‡ã€‚è¯·æ£€æŸ¥æ•°æ®æºã€‚'),
                        React.createElement(
                            'button',
                            { className: 'bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105', onClick: onBack },
                            'è¿”å›ä¸»é¡µ'
                        )
                    );
                }

                // è·å–å½“å‰æ˜¾ç¤ºçš„æŠ½è®¤å¡
                const currentFlashcard = shuffledVocabulary[currentFlashcardIndex];
                // æ£€æŸ¥å½“å‰å¡ç‰‡æ˜¯å¦å·²è¢«æ ‡è®°ä¸ºå·²æŒæ¡
                const isLearned = learningProgress.learnedFlashcards[currentFlashcard?.chinese];

                return React.createElement(
                    'div',
                    { className: 'flex flex-col items-center w-full max-w-md sm:max-w-xl bg-white p-6 rounded-lg shadow-xl border border-gray-200' },
                    React.createElement('h2', { className: 'text-2xl sm:text-3xl font-bold mb-6 text-gray-800' }, 'æŠ½è®¤å¡å¤ä¹ '),
                    // æŠ½è®¤å¡å®¹å™¨ï¼Œç‚¹å‡»å¯ç¿»è½¬
                    React.createElement(
                        'div',
                        {
                            className: `flashcard-container relative w-full h-64 sm:h-80 bg-blue-100 rounded-xl shadow-lg flex items-center justify-center cursor-pointer transform transition-all duration-500 ease-in-out ${showBack ? 'rotate-y-180' : ''}`,
                            onClick: handleFlip,
                            style: { perspective: '1000px' } // ä¿æŒ3Dé€è§†æ•ˆæœ
                        },
                        // æŠ½è®¤å¡æ­£é¢ï¼šæ˜¾ç¤ºä¸­æ–‡è¯æ±‡
                        React.createElement(
                            'div',
                            { className: `flashcard-face absolute w-full h-full backface-hidden flex items-center justify-center p-4 text-center rounded-xl bg-gradient-to-br from-blue-100 to-blue-200 transition-opacity duration-300 ${showBack ? 'opacity-0' : 'opacity-100'}` },
                            React.createElement('p', { className: 'text-3xl sm:text-4xl font-extrabold text-blue-800 leading-tight' }, currentFlashcard?.chinese)
                        ),
                        // æŠ½è®¤å¡èƒŒé¢ï¼šæ˜¾ç¤ºè‹±æ–‡è¯æ±‡å’Œè¯´æ˜
                        React.createElement(
                            'div',
                            { className: `flashcard-back absolute w-full h-full backface-hidden flex flex-col items-center justify-center p-4 text-center rounded-xl bg-gradient-to-br from-blue-200 to-blue-300 rotate-y-180 transition-opacity duration-300 ${showBack ? 'opacity-100' : 'opacity-0'}` },
                            React.createElement('p', { className: 'text-2xl sm:text-3xl font-semibold text-blue-700 mb-2 leading-tight' }, currentFlashcard?.english),
                            React.createElement('p', { className: 'text-lg sm:text-xl text-blue-600 mt-2 leading-relaxed' }, currentFlashcard?.explanation)
                        )
                    ),
                    React.createElement(
                        'div',
                        { className: 'flex justify-between w-full max-w-xs sm:max-w-sm mt-8 mb-6' },
                        React.createElement(
                            'button',
                            { className: 'bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-300', onClick: handleShuffle },
                            'æ´—ç‰Œ'
                        ),
                        React.createElement(
                            'button',
                            { className: 'bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300', onClick: handleNextFlashcard },
                            `ä¸‹ä¸€å¼  (${currentFlashcardIndex + 1}/${shuffledVocabulary.length})`
                        )
                    ),
                    React.createElement(
                        'button',
                        {
                            className: `font-bold py-4 px-8 rounded-xl shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105 hover:shadow-2xl focus:outline-none focus:ring-4 ${isLearned ? 'bg-gray-300 text-gray-700 cursor-not-allowed ring-gray-200' : 'bg-green-600 hover:bg-green-700 text-white ring-green-300'}`,
                            onClick: handleMarkLearned,
                            disabled: isLearned
                        },
                        isLearned ? 'å·²æŒæ¡' : 'æˆ‘æŒæ¡äº†è¿™å¼ å¡ç‰‡'
                    ),
                    React.createElement(
                        'button',
                        { className: 'mt-8 bg-gray-400 hover:bg-gray-500 text-white font-bold py-2.5 px-5 rounded-lg shadow-md transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-200', onClick: onBack },
                        'è¿”å›ä¸»é¡µ'
                    )
                );
            };

            // å°†Appç»„ä»¶æ¸²æŸ“åˆ°DOMä¸­çš„idä¸º'root'çš„å…ƒç´ 
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(React.createElement(App, null));
        }; // End of window.onload
    </script>
</body>
</html>
